{% extends 'teacherside/base.html' %}

{% load static %}

{% block title %}Take Exam - {{ exam.title }}{% endblock %}

{% block header %}{{ exam.title }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-10 offset-md-1">
        <div class="alert alert-info">
            <strong>Status:</strong> <span id="status" style="color: darkblue;">Tab is focused</span>
        </div>
        
        <form method="post" id="exam-form" action="{% url 'teacher-submit-exam' %}">
            {% csrf_token %}
            <input type="hidden" name="event_log" id="event-log-input">
            
            <div class="card">
                <div class="card-header">
                    <h4>Exam Questions</h4>
                </div>
                <div class="card-body">
                    {% for question in questions %}
                    <div class="mb-4">
                        <h5>Question {{ forloop.counter }}</h5>
                        <p>{{ question.question_text }}</p>
                        
                        {% if question.question_type == 'numerical' %}
                            <input type="text" name="answer_{{ question.id }}" class="form-control" required>
                        {% elif question.question_type == 'true_false' %}
                            <div class="form-check">
                                <input type="radio" name="answer_{{ question.id }}" value="True" class="form-check-input" required>
                                <label class="form-check-label">True</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" name="answer_{{ question.id }}" value="False" class="form-check-input" required>
                                <label class="form-check-label">False</label>
                            </div>
                        {% elif question.question_type == 'mcq_one' %}
                            {% for choice in question.choices %}
                            <div class="form-check">
                                <input type="radio" name="answer_{{ question.id }}" value="{{ choice }}" class="form-check-input" required>
                                <label class="form-check-label">{{ choice }}</label>
                            </div>
                            {% endfor %}
                        {% elif question.question_type == 'mcq_multi' %}
                            {% for choice in question.choices %}
                            <div class="form-check">
                                <input type="checkbox" name="answer_{{ question.id }}" value="{{ choice }}" class="form-check-input">
                                <label class="form-check-label">{{ choice }}</label>
                            </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <div class="mt-3">
                <button type="submit" class="btn btn-primary">Submit Exam</button>
            </div>
        </form>
    </div>
</div>

<!-- Warning Overlay (initially hidden) -->
<div id="warning-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 0, 0, 0.95); z-index: 9999; color: white; text-align: center; padding-top: 20%;">
    <h1>⚠️ VIOLATION DETECTED ⚠️</h1>
    <h3>You attempted to access developer tools or right-click menu.</h3>
    <p style="font-size: 18px;">This exam session has been flagged for review.</p>
    <p style="font-size: 18px;">Your attempt has been logged with a timestamp.</p>
    <p style="font-size: 16px; margin-top: 30px;">This page will remain blocked for security purposes.</p>
    <p style="font-size: 14px; color: #ffcccc; margin-top: 50px;">If this was accidental, please contact your instructor.</p>
</div>

<style>
    .blocked {
        pointer-events: none;
        user-select: none;
        filter: blur(10px);
    }
</style>

<script>
    const CSRF_TOKEN = '{{ csrf_token }}';
    const EXAM_ID = {{ exam.id|default:"null" }};
</script>
<script src="{% static 'teacherside/js/test_exam.js' %}"></script>

{% endblock %}